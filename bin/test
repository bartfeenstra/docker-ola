#!/usr/bin/env bash

cd `dirname "$0"`/..

# Exit on errors
trap 'exit $?' ERR

# Run a container specifically for this test.
./bin/build test
container_name=bartfeenstra_ola_test
docker run -d --name $container_name bartfeenstra/ola:test
container_ip=`docker inspect -f '{{range .NetworkSettings.Networks}}{{.IPAddress}}{{end}}' $container_name`

# Connect to OLA.
./bin/wait-for-it $container_ip:9090
curl --verbose -f http://$container_ip:9090 > /dev/null

docker stop $container_name
docker container rm $container_name
